diff -Nur instead/Rules.caanoo instead.caanoo/Rules.caanoo
--- instead/Rules.caanoo	1970-01-01 03:00:00.000000000 +0300
+++ instead.caanoo/Rules.caanoo	2012-01-05 17:41:44.081942766 +0400
@@ -0,0 +1,44 @@
+VERSION := 1.6.0
+
+PREFIX  = /home/peter/Devel/GPH_SDK/tools/gcc-4.2.4-glibc-2.7-eabi
+CC        = $(PREFIX)/bin/arm-gph-linux-gnueabi-gcc
+STRIP     = $(PREFIX)/bin/arm-gph-linux-gnueabi-strip
+
+CFLAGS     += -DARM_ARCH -DGP2X_BUILD
+CFLAGS     += -DWIZ_BUILD -DCAANOO
+CFLAGS     += -O3 -std=c99 -msoft-float -funsigned-char -fno-common -fno-builtin -Wl,--allow-multiple-definition
+CFLAGS     += -I../SDL-1.2.13/include `$(PREFIX)/arm-gph-linux-gnueabi/sys-root/usr/bin/sdl-config --cflags` -I$(PREFIX)/include
+DESTDIR=
+BIN=
+DATAPATH=.
+STEADPATH=$(DATAPATH)/stead
+THEMESPATH=$(DATAPATH)/themes
+GAMESPATH=$(DATAPATH)/games
+ICONPATH=$(DATAPATH)/icon
+LANGPATH=$(DATAPATH)/lang
+DOCPATH=
+MANPATH=
+SYSTEMSETUP=no
+
+ZLIB_CFLAGS=
+ZLIB_LFLAGS=-lz
+
+LUA_CFLAGS=-I../lua-5.1.4/src
+LUA_LFLAGS=../lua-5.1.4/src/liblua.a
+
+SDL_CFLAGS=
+SDL_LFLAGS=-lSDL -lSDL_mixer -lSDL_image -lSDL_ttf -lm -ldl -lpthread -lz
+
+CFLAGS	+= -g -Wall -Dunix -D_USE_UNPACK -D_LOCAL_APPDATA # -D_SDL_MOD_BUG
+
+INSTALLD=echo "Do not install standalone version!"
+INSTALLB=echo "Do not install standalone version!"
+INSTALL=echo "Do not install standalone version!"
+LN=echo "Do not install standalone version!"
+
+EXE=
+PLATFORM=unix.c
+RESOURCES=
+RM=rm
+AR=ar rc
+RANLIB=ranlib
diff -Nur instead/src/sdl-instead/game.c instead.caanoo/src/sdl-instead/game.c
--- instead/src/sdl-instead/game.c	2012-01-05 17:41:55.258503261 +0400
+++ instead.caanoo/src/sdl-instead/game.c	2012-01-05 17:41:44.228608038 +0400
@@ -3144,7 +3144,7 @@
 				mouse_reset(1);
 				game_menu(menu_askquit);
 #endif
-			} else if (alt_pressed && (!is_key(&ev, "q") || !is_key(&ev, "f4"))) {
+			} else if (!is_key(&ev, "quit") || (alt_pressed && (!is_key(&ev, "q") || !is_key(&ev, "f4")))) {
 				break;
 			} else if (alt_pressed &&
 				(!is_key(&ev, "enter") || !is_key(&ev, "return"))) {
diff -Nur instead/src/sdl-instead/graphics.c instead.caanoo/src/sdl-instead/graphics.c
--- instead/src/sdl-instead/graphics.c	2012-01-05 17:41:55.245170054 +0400
+++ instead.caanoo/src/sdl-instead/graphics.c	2012-01-05 17:41:44.228608038 +0400
@@ -1294,13 +1294,20 @@
 
 int gfx_set_mode(int w, int h, int fs)
 {
+	int maxbpp = 32;
 	if (gfx_width == w && gfx_height == h && gfx_fs == fs)
 		return 0; /* already done */
+#ifdef CAANOO
+	maxbpp = 16;
+#endif
 	vid_modes = NULL;
 	gfx_fs = fs;
 	gfx_width = w;
 	gfx_height = h;
 	SDL_ShowCursor(SDL_DISABLE);
+#ifdef CAANOO
+	screen = SDL_SetVideoMode(gfx_width, gfx_height, maxbpp, ((gfx_fs)?SDL_HWSURFACE:0) | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
+#else
 #ifdef S60
 	screen = SDL_SetVideoMode(gfx_width, gfx_height, 0, SDL_ANYFORMAT | SDL_HWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
 #else
@@ -1311,15 +1318,15 @@
 	screen = SDL_SetVideoMode(gfx_width, gfx_height, 16, SDL_DOUBLEBUF | SDL_HWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
   #else
    #ifdef __APPLE__	
-	screen = SDL_SetVideoMode(gfx_width, gfx_height, (fs)?32:0, SDL_SWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
+	screen = SDL_SetVideoMode(gfx_width, gfx_height, (fs)?maxbpp:0, SDL_SWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
 	if (screen == NULL) /* ok, fallback to anyformat */
 		screen = SDL_SetVideoMode(gfx_width, gfx_height, 0, SDL_ANYFORMAT | SDL_SWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
    #else
     #ifndef _WIN32_WCE
 	#if SDL_VERSION_ATLEAST(1,3,0)
-	screen = SDL_SetVideoMode(gfx_width, gfx_height, 32, SDL_DOUBLEBUF | SDL_HWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
+	screen = SDL_SetVideoMode(gfx_width, gfx_height, maxbpp, SDL_DOUBLEBUF | SDL_HWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
 	#else
-	screen = SDL_SetVideoMode(gfx_width, gfx_height, (fs)?32:0, SDL_DOUBLEBUF | SDL_HWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
+	screen = SDL_SetVideoMode(gfx_width, gfx_height, (fs)?maxbpp:0, SDL_DOUBLEBUF | SDL_HWSURFACE | ( ( fs ) ? SDL_FULLSCREEN : 0 ) );
 	#endif
 	if (screen == NULL) /* ok, fallback to anyformat */
     #endif
@@ -1328,6 +1335,7 @@
   #endif
  #endif
 #endif
+#endif
 	if (screen == NULL) {
 		fprintf(stderr, "Unable to set %dx%d video: %s\n", w, h, SDL_GetError());
 		return -1;
@@ -4154,7 +4162,7 @@
 
 int gfx_init(void)
 {
-	if (SDL_Init(SDL_INIT_VIDEO | SDL_INIT_TIMER) < 0) {
+	if (SDL_Init(SDL_INIT_VIDEO | SDL_INIT_TIMER | SDL_INIT_JOYSTICK) < 0) {
 		fprintf(stderr, "Couldn't initialize SDL: %s\n", SDL_GetError());
 		return -1;
 	}
diff -Nur instead/src/sdl-instead/input.c instead.caanoo/src/sdl-instead/input.c
--- instead/src/sdl-instead/input.c	2012-01-05 17:41:55.255169959 +0400
+++ instead.caanoo/src/sdl-instead/input.c	2012-01-05 17:41:44.228608038 +0400
@@ -44,6 +44,10 @@
 {
 	SDL_EnableKeyRepeat(500, 30);
 	m_focus = !!(SDL_GetAppState() & SDL_APPMOUSEFOCUS);
+	if(SDL_NumJoysticks() > 0) {
+		SDL_JoystickOpen(0);
+		SDL_JoystickEventState(SDL_ENABLE);
+	}
 	return 0;
 }
 
@@ -53,7 +57,32 @@
 	while (SDL_PollEvent(&event));
 	return;
 }
-
+#ifdef CAANOO
+static const char *joy_map(int button)
+{
+	switch(button) {
+	case 2:
+		return "left";
+	case 6:
+		return "right";
+	case 0:
+		return "up";
+	case 4:
+		return "down";
+	case 15:
+		return "space"; //y
+	case 14:
+		return "tab"; //x
+	case 12:
+		return "escape"; // a
+	case 13:
+		return "return"; // b
+	case 8:
+		return "quit";
+	}
+	return "f1";
+}
+#endif
 int input(struct inp_event *inp, int wait)
 {	
 	int rc;
@@ -102,6 +131,20 @@
 	case SDL_QUIT:
 		game_running = 0;
 		return -1;
+#ifdef CAANOO
+	case SDL_JOYBUTTONDOWN:
+		inp->type = KEY_DOWN;
+		inp->code = event.jbutton.button;
+		strncpy(inp->sym, joy_map(event.jbutton.button), sizeof(inp->sym));
+		inp->sym[sizeof(inp->sym) - 1] = 0;
+		break;
+	case SDL_JOYBUTTONUP:
+		inp->type = KEY_UP;
+		inp->code = event.jbutton.button;
+		strncpy(inp->sym, joy_map(event.jbutton.button), sizeof(inp->sym));
+		inp->sym[sizeof(inp->sym) - 1] = 0;
+		break;
+#endif
 	case SDL_KEYDOWN:	//A key has been pressed
 		inp->type = KEY_DOWN; 
 		inp->code = event.key.keysym.scancode;
diff -Nur instead/src/sdl-instead/sound.c instead.caanoo/src/sdl-instead/sound.c
--- instead/src/sdl-instead/sound.c	2012-01-05 17:41:55.251836658 +0400
+++ instead.caanoo/src/sdl-instead/sound.c	2012-01-05 17:41:44.228608038 +0400
@@ -1,8 +1,9 @@
+#include <SDL.h>
+#include <SDL_mixer.h>
+
 #include "externals.h"
 #include "internals.h"
 
-#include <SDL.h>
-#include <SDL_mixer.h>
 #include "sdl_idf.h"
 
 #ifdef S60
